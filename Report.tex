% VDE Template for EUSAR Papers
% Provided by Barbara Lang und Siegmar Lampe
% University of Bremen, January 2002
% English version by Jens Fischer
% German Aerospace Center (DLR), December 2005
% Additional modifications by Matthias Wei{\ss}
% FGAN, January 2009

%-----------------------------------------------------------------------------
% Type of publication
\documentclass[a4paper,10pt]{article}
%-----------------------------------------------------------------------------
% Other packets: Most packets may be downloaded from www.dante.de and
% "tcilatex.tex" can be found at (December 2005):
% http://www.mackichan.com/techtalk/v30/UsingFloat.htm
% Not all packets are necessarily needed:
\usepackage[T1]{fontenc}
\usepackage[latin1]{inputenc}
%\usepackage{ngerman} % in german language if required
\usepackage[nooneline,bf]{caption} % Figure descriptions from left margin
\usepackage{times}
\usepackage{multicol}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[dvips]{graphicx}
\usepackage{epsfig}
\input{tcilatex}
%-----------------------------------------------------------------------------
% Page Setup
\textheight24cm \textwidth17cm \columnsep6mm
\oddsidemargin-5mm                 % depending on print drivers!
\evensidemargin-5mm                % required margin size: 2cm
\headheight0cm \headsep0cm \topmargin0cm \parindent0cm
\pagestyle{empty}                  % delete footer and header
%----------------------------------------------------------------------------
% Environment definitions
\newenvironment*{mytitle}{\begin{LARGE}\bf}{\end{LARGE}\\[1.5ex]}%
\newenvironment*{myabstract}{\begin{Large}\bf}{\end{Large}\\[2.5ex]}%
%-----------------------------------------------------------------------------
% Using Pictures and tables:
% - Instead "table" write "tablehere" without parameters
% - Instead "figure" write "figurehere " without parameters
% - Please insert a blank line before and after \begin{figuerhere} ... \end{figurehere}
%
% CAUTION:   The first reference to a figure/table in the text should be formatted fat.
%
\makeatletter
\newenvironment{tablehere}{\def\@captype{table}}{}
\newenvironment{figurehere}{\def\@captype{figure}\vspace{2ex}}{\vspace{2ex}}
\makeatother



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}

% Please use capital letters in the beginning of important words as for example
\begin{mytitle} A LaTeX Report Template. \end{mytitle}
%
% Please do not insert a line here
%
\\
\hspace{10ex}
Marini Matteo\\
Matr. 724626\\[10ex]

\begin{myabstract} Abstract \end{myabstract}
This report explains how a kernel with a new patch is tested and 
which data and graphics are generated. It is explained how to insert new kernel to test
and it shows the workflow followed to compare vanilla kernel with new kernels

\vspace{4ex}	% Please do not remove or reduce this space here.
\begin{multicols}{2}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}

To understand how to improve kernel performance, it was necessary to develop a toolchain
that, for each kernel to test, it performs automatically necessary measures.
This toolchain select kernel to test, execute tests, select next kernel and reboot system.
All theese activities are performed automatically. User can decide which test to do, 
editing a configuration file present in toolchain. Detailed documentation of each script
used is in relative bash script file.
This report is divided in TODO numero sezioni sections: the first section presents a
briefly description of benchmark used to measure kernel patch improvements, 
the second section describes structure of the toolchain,
the third section shows an high level description of bash scripts that performs
all measures, the fourth section describes which data are produced, how to use them
and logic used to build bar graphs. In the last section are examined possible use case
of toolchain

TODO: mettere le storie sulla possibile espansione della toolchain verso altri benchmark
magari come use case

TODO: per ora mi viene in mente solo qeusto use case

TODO: da qualche parte devo mettere la naming convention

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Benchmark and tool used to measure kernel improvements}
% Please avoid separations in titles
% and separate text manually

Application used as benchmark for kernel patch has this structure

TODO figure of benchmark, 

How application works is well documented in TODO metti ref alla tesi di lucas
Each sample of sink mixer is produce periodically. Monitor is task that launches "start"
signal for production of a sample, therefore benchmark can be launched only with
monitor. Number of sample (NR\_SAM) to produce is decided by it. 
For each sample, monitor measure arrival time. At the end of application 
monitor has recorded NR\_SAM arrival times and it can provides 
\textbf{ average and variance} of theese arrival times. 
Theese statistical values are principal measures to characterize 
kernel patches improvements.

Other important measures are obtained by combined use of monitor and ftrace.
With sched\_switch tracer, it is possible retrive averge execution time of each
benchmark task, how? A bash script launches benchmark with monitor. 
Before to first "start" signal for benchmark, monitor enables sched\_switch tracer. 
Output of  tracer is a file that shows timestamps of context switch and 
wakeup of each task of the benchmark. According by theese informations, it is possible 
compute average scheduling latency and average execution time (AET) of each task.
With function graph tracer it is possible retrive AET of each
call of interesting kernel functions. Also in this case, a bash script launches
benchmark with monitor that enables function graph tracer before to send "start" signal
for the first benchmark sample. Output of tracer is a file that shows latency of each
kernel function call and other information such as context within function is called,
cpu that is executing function etc..
According by theese informations, it is possible compute AET of each 
function call and ...

TODO tante altre cose che solo alla fine dir\'o quali mi servono e quali no

It is clear that for each measure, it is necessary to launch benchmark and monitor by 
a bash script used as wrapper, and produced data are managed by wrapper in order
to produce graphics, png etc..
In the toolchain there is one main test. We call main test a bash script that 
performs different measures, in plain words: a scripts that call more than one
scripts that wraps benchmark and monitor. Main test present in toolchain 
is called "Performace test" (ptest for briefly)
and it is implemented in run.sh. In the third section is explained how it works. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Toolchain structure}

Toolchain has structure see in 

TODO insert here figure of toolchain structure

\begin{description}
	\item[bmarks] contains benchmark binaries 
	\item[images] contains kernel images to test
	\item[scripts] contains bash scripts to produce graphics and execute benchmark
	\item[results] contains data produced
	\item[log] contains test log files
\end{description}

All folders are "flat" TODO intendo dire directory piatte che han dentro solo files
directories, instead results folder has a dynamic strcuture. It follows this schema:

TODO insert here figure of results structure

Every times that a main test is executed, a new folder in results directory is created.
Name of new folder is composed by date\_of\_today-version\_localversion of kernel in use
In this folder it will be created theese directories:

\begin{description}
	\item[data:] contains text files produced by different scripts called by main test executed
	\item[graphs:] contains plot files generated according files present in data folder
	\item[png:] contains png files produced by different scripts called by main test executed
\end{description}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{ptest functioning}

ptest is main test to measure AET of a sample, AET of each task, load/store 
miss rate of benchmark, AET of kernel functions.

ptest is based on a configration file called init.env that user can modify using 
bash script init\_env.sh. In this file there are many paramteres, for a detailed
documentation about them see init.env, now we pay attention only on most important.
Theese are:

\begin{description}
	\item[DIM\_LIST:] it is the list of buffer dimensions to use in benchmark
	\item[NR\_TRY\_PERFORMANCE\_TEST:] it is the number of iteration executed by ptest
\end{description}

we call NR\_DIM number of elements present in DIM\_LIST

TODO ha poco senso la frase sotto messa cos√¨
ptest executes wrapper bash scripts for each kernel present in images folder

ptest follows this steps:

\begin{description}
	\item[Step1:] User specifies in init\_env.sh two parameters previously seen 
and execute init\_env.sh to configure init.env 
For example: consider NR\_TRY\_PERFORMANCE\_TEST=10 DIM\_LIST="4 8 16 32"
Pay attention to theese data, because are taken as reference for next steps
	\item[Step2:] launch run.sh. This script, enter in a loop and for 
NR\_TRY\_PERFORMANCE\_TEST iterations executes script to measure 
AET of a sample, AET of each task, load/store miss rate. Each script 
launches benchmark with different buffer dimensions. In our case 
with 4, 8, 16 and 32 Kb, therefore each script is executed 
NR\_TRY\_PERFORMANCE\_TEST x NR\_DIM. 
Produced files by each script are analyzed in the next section 
	\item[Step3:] build bar graphs. A script read data in data folder,
builds bar graphics and put them in graphics folder. Details about graphics are
in the next section
	\item[Step4:] select another kernel to test, reboot system and go to Step2 
until all kernel in image folder are tested.
	\item[Step5:] build global graphics. According data in different data folders
created, builds "global" graphics

\end{description}

TODO alla fine metti la storia che run.sh si pu\'o lanciare se \'e in esecuzione
un kernel presente in images





% We suggest the use of JabRef for editing your bibliography file (Report.bib)
\bibliographystyle{splncs}
\bibliography{Report}

\end{multicols}
\end{document}
